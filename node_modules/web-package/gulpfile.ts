import gulp = require("gulp");
import ts = require("gulp-typescript");
import sourcemaps = require("gulp-sourcemaps");
import merge = require("merge2");

const sourceFiles = "src/**/*.ts";
const tsProject = () => ts.createProject("tsconfig.json", { });

function buildTs() {
    // const tsResult = gulp.src(sourceFiles)
    //     .pipe(sourcemaps.init())
    //     .pipe(tsProject());

    return merge([
        gulp.src(sourceFiles).pipe(sourcemaps.init()).pipe(tsProject()()).js.pipe(sourcemaps.write("./")).pipe(gulp.dest("dist/")),
        gulp.src(sourceFiles).pipe(tsProject()()).dts.pipe(gulp.dest("dist/"))
    ]);
}

function watchFiles() {
    gulp.watch(sourceFiles, buildTs);
}

gulp.task("build", buildTs);
gulp.task("watch", gulp.series("build", watchFiles) as any);

